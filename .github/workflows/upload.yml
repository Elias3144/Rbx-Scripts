name: Update Script

on:
  push:
    branches:
      - main

jobs:
  update-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set random script ID
        id: set-script-id
        run: echo "SCRIPT_ID=$(shuf -i 100000-999999 -n 1)" >> $GITHUB_ENV

      - name: Install Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Update script
        run: |
          const fs = require('fs');
          const fetch = require('node-fetch');

          const files = fs.readFileSync('files.txt', 'utf8').trim().split('\n');
          const scriptId = process.env.SCRIPT_ID;

          files.forEach((file) => {
            const content = fs.readFileSync(file, 'base64');
            const payload = {
              script_id: scriptId,
              text: content,
            };

            fetch('https://your-endpoint-url.com/api/update-script', {
              method: 'POST',
              body: JSON.stringify(payload),
              headers: { 'Content-Type': 'application/json' },
            })
              .then((response) => response.text())
              .then((responseText) => console.log(responseText))
              .catch((error) => console.error(error));
          });
